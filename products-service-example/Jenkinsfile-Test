def test

pipeline {
    agent any
    stages {
        stage("Init") {
            steps {
                script {
                    def comandossh = "ssh -i /var/jenkins_home/keyssh-devops-curso.pem ec2-user@172.31.25.112 sudo "
                    def branchName = env.BRANCH_NAME
                    def gitCredentials = "CREDENTIAL_ID"
                    def repoUrl = "https://github.com/devopsort/products-service-example.git"
                    //test = load load ("/var/jenkins_home/workspace/products-service-example_Test/products-service-example/script.groovy")
                }
            }
        }

        stage('CloneRepo') {
            steps {
                echo 'Pulling...' + params.branchName
                checkout scm
            
            }
        }
        /*stage('CloneRepo') {
            steps {
                echo "-------------------------------------------------------------------"
                sh "ssh -i /var/jenkins_home/keyssh-devops-curso.pem ec2-user@JenkinsDockerTF sudo   ' rm -rf *.zip'"
                sh "ssh -i /var/jenkins_home/keyssh-devops-curso.pem ec2-user@JenkinsDockerTF sudo   ' wget ${RepoURL}${params.Enviromnment}.zip'"
                sh "ssh -i /var/jenkins_home/keyssh-devops-curso.pem ec2-user@JenkinsDockerTF sudo   ' unzip -o ${params.Enviromnment}.zip'"
            }
        }*/

        stage("Build") {
            steps {
                echo "-------------------------------------------------------------------"
                sh "${comandossh} sudo  'docker build --build-arg JAR_FILE=products-service-example.jar -t 127.0.0.1:5000/products-service:${branchName} ./ac1cicd-${branchName} '"
            }
        }

        stage("Deploy in Test env") {
            steps {
                sh "${comandossh} sudo 'docker run -d --name products-service-${branchName} -p 81:8080  127.0.0.1:5000/products-service:${branchName}'"
            }
        }
    }
}